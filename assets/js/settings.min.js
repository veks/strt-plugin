!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(((global="undefined"!=typeof globalThis?globalThis:global||self).strt=global.strt||{},global.strt.strtSettings=global.strt.strtSettings||{}))}(this,function(exports){"use strict";const isArray=term=>null!=term&&Array.isArray(term),isObject=term=>!(term=>null===term)(term)&&"object"==typeof term&&term.constructor===Object&&!isArray(term),shallowEqual=(a,b)=>{if(a&&b){if(isObject(a)&&isObject(b))return function(a,b){if(a===b)return!0;const aKeys=Object.keys(a),bKeys=Object.keys(b);if(aKeys.length!==bKeys.length)return!1;let i=0;for(;i<aKeys.length;){const key=aKeys[i],aValue=a[key];if(void 0===aValue&&!b.hasOwnProperty(key)||aValue!==b[key])return!1;i++}return!0}(a,b);if(isArray(a)&&isArray(b))return function(a,b){if(a===b)return!0;if(a.length!==b.length)return!1;for(let i=0,len=a.length;i<len;i++)if(a[i]!==b[i])return!1;return!0}(a,b)}return a===b},windowRef="undefined"!=typeof window?window:{},settings="object"==typeof windowRef.strtSettings?windowRef.strtSettings:{},KEY_EVENT=key=>`strt:settings:${key}`,canDispatch="function"==typeof windowRef.dispatchEvent,canListen="function"==typeof windowRef.addEventListener,getSetting=function(name){let fallback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,filter=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(val,fb)=>void 0!==val?val:fb;if("string"!=typeof name)throw new Error('getSetting: Параметр "name" должен быть строкой');return filter(name in settings?settings[name]:fallback,fallback)},ADMIN_URL=getSetting("adminUrl",""),HOME_URL=getSetting("homeUrl",""),IS_USER_LOGGED_IN=getSetting("isUserLoggedIn",!1),CURRENT_USER=getSetting("currentUser",!1),CURRENT_USER_IS_ADMIN=getSetting("currentUserIsAdmin",!1),WP_RESET_NONCE=getSetting("wpResetNonce",""),CURRENCY=getSetting("currency",{}),WEIGHT_UNIT=getSetting("weightUnit",""),STORE_PAGES=getSetting("storePages",{}),PLACEHOLDER_IMG=getSetting("placeholderImg",{}),ACCOUNT_MENU=getSetting("accountMenu",{}),WC_STORE_API_NONCE=getSetting("wcStoreApiNonce",""),API=getSetting("apiIntegration",[]);exports.ACCOUNT_MENU=ACCOUNT_MENU,exports.ADMIN_URL=ADMIN_URL,exports.API=API,exports.CURRENCY=CURRENCY,exports.CURRENT_USER=CURRENT_USER,exports.CURRENT_USER_IS_ADMIN=CURRENT_USER_IS_ADMIN,exports.HOME_URL=HOME_URL,exports.IS_USER_LOGGED_IN=IS_USER_LOGGED_IN,exports.NAMESPACE="strt",exports.PLACEHOLDER_IMG=PLACEHOLDER_IMG,exports.STORE_PAGES=STORE_PAGES,exports.WC_STORE_API_NONCE=WC_STORE_API_NONCE,exports.WEIGHT_UNIT=WEIGHT_UNIT,exports.WP_RESET_NONCE=WP_RESET_NONCE,exports.getSetting=getSetting,exports.getSettingWithCoercion=function(){let name=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",fallback=arguments.length>1?arguments[1]:void 0,typeguard=arguments.length>2?arguments[2]:void 0;const value=name in settings?settings[name]:fallback;return typeguard(value,fallback)?value:fallback},exports.getSettings=()=>({...settings}),exports.onAnySetting=handler=>{if("function"!=typeof handler)throw new Error('onAnySetting: Параметр "handler" должен быть функцией');if(!canListen)return()=>{};const listener=event=>handler(event.detail);return windowRef.addEventListener("strt:settings",listener),()=>{try{windowRef.removeEventListener("strt:settings",listener)}catch(error){console.error('Ошибка при отписке от события "strt:settings":',error)}}},exports.onSetting=(name,handler)=>{if("string"!=typeof name)throw new Error('onSetting: Параметр "name" должен быть строкой');if("function"!=typeof handler)throw new Error('onSetting: Параметр "handler" должен быть функцией');if(!canListen)return()=>{};const listener=event=>handler(event.detail);return windowRef.addEventListener(KEY_EVENT(name),listener),()=>{try{windowRef.removeEventListener(KEY_EVENT(name),listener)}catch(error){console.error(`Ошибка при отписке от события "${KEY_EVENT(name)}":`,error)}}},exports.setSetting=(name,value)=>{if("string"!=typeof name)throw new Error('setSetting: Параметр "name" должен быть строкой');const previousValue=settings[name];settings[name]=value;const changed=!shallowEqual(previousValue,value);if(canDispatch&&changed)try{windowRef.strt=windowRef.strt||{},windowRef.strtSettings=settings,windowRef.dispatchEvent(new CustomEvent("strt:settings",{detail:{key:name,value:value}})),windowRef.dispatchEvent(new CustomEvent(KEY_EVENT(name),{detail:value}))}catch(error){console.error(`Ошибка при вызове событий для настройки "${name}":`,error)}},exports.setSettingsBatch=updates=>{if("object"!=typeof updates||null===updates)throw new Error('setSettingsBatch: Параметр "updates" должен быть объектом');const changedSettings=[];if(Object.entries(updates).forEach(_ref=>{let[key,value]=_ref;if("string"!=typeof key)throw new Error(`setSettingsBatch: Ключ "${key}" должен быть строкой`);const prev=settings[key],changed=!shallowEqual(prev,value);settings[key]=value,changed&&changedSettings.push({key:key,value:value})}),canDispatch&&changedSettings.length>0)try{windowRef.strt=windowRef.strt||{},windowRef.strtSettings=settings,changedSettings.forEach(_ref2=>{let{key:key,value:value}=_ref2;windowRef.dispatchEvent(new CustomEvent(KEY_EVENT(key),{detail:value}))}),windowRef.dispatchEvent(new CustomEvent("strt:settings",{detail:changedSettings}))}catch(error){console.error("Ошибка при вызове событий в setSettingsBatch:",error)}}});